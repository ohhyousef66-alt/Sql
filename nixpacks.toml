[phases.setup]
nixPkgs = ["nodejs_20", "chromium", "nss", "freetype", "harfbuzz", "fontconfig", "glib", "pango", "cairo", "libdrm", "mesa", "alsa-lib", "cups", "dbus", "at-spi2-atk", "gtk3", "xorg.libX11", "xorg.libXcomposite", "xorg.libXdamage", "xorg.libXext", "xorg.libXfixes", "xorg.libXrandr", "xorg.libxcb"]

[phases.install]
cmds = ["npm ci", "npx playwright install chromium"]

[phases.build]
cmds = ["npm run build"]

[start]
cmd = "NODE_ENV=production NODE_OPTIONS='--max-old-space-size=8192 --max-semi-space-size=128' node dist/index.cjs"

[variables]
PLAYWRIGHT_BROWSERS_PATH = "/app/.cache/ms-playwright"
NODE_ENV = "production"
